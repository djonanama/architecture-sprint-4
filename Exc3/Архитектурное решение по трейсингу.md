# Архитектурное решение по трейсингу

## Мотивация
Внедрение системы трейсинга позволит:
- Определять, где и почему возникают задержки в обработке заказов.
- Повышать прозрачность работы системы за счёт детального анализа цепочек вызовов.
- Оптимизировать архитектуру за счёт выявления узких мест.
- Улучшить диагностику инцидентов и ускорить их устранение.

## Область покрытия трейсингом
Трассировке подлежат:
- Все API-запросы и их взаимодействие с базами данных.
- Очереди сообщений и обработка событий.
- Внешние интеграции с платежными сервисами и логистическими системами.
- Критические пользовательские сценарии (создание заказа, обработка платежа, доставка).

## Данные для трейсинга
- Уникальный идентификатор запроса.
- Время начала и окончания выполнения запроса.
- Список вызванных сервисов и их последовательность.
- Коды ответов и возможные ошибки.
- Производительность каждого шага обработки запроса.

## Предлагаемое решение
- Использовать **Jaeger** и **OpenTelemetry** для распределённого трейсинга.
- Внедрить OTEL sdk в API для автоматического сбора трассировок.
- Добавить поддержку трейсинга в очередь сообщений.

[Диаграмму контейнеров Александрита](https://drive.google.com/file/d/1WamPQXKHudKCtZ_ey27ALrWXfnzxfDl8/view?usp=sharing)

## Компромиссы
- В некоторых внешних сервисах невозможно внедрить трейсинг без доработок.
- Высокий объём данных может потребовать значительных ресурсов для хранения и обработки трассировок.
- Полный охват всех компонентов системы может быть дорогостоящим, поэтому начальный этап внедрения сфокусируется на критически важных сценариях.

## Аспекты безопасности
- Аутентификация и ограничение доступа к данным трейсинга.
- Шифрование трассировок и логов, содержащих персональные данные.
- Разграничение прав доступа к различным уровням информации.
